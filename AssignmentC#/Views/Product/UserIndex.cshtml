@{
    ViewBag.Title = "Product | Index";
}

@section head {
    <style>
        .info-bar {
            background: #f8f9fa;
            padding: 10px;
            margin-bottom: 10px;
            text-align: center;
            border-radius: 6px;
            margin-top: 10px;
        }

        .top-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .back-btn {
            text-decoration: none;
            padding: 6px 12px;
            background: #6c757d;
            color: #fff;
            border-radius: 5px;
            font-size: 14px;
            margin-left: 20px;
        }

        .category-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            background: #fff;
            padding: 14px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .cat-btn {
            color: #000;
            text-decoration: none;
            font-size: 18px;
            padding-bottom: 6px;
            position: relative;
            font-weight: 500;
        }

            .cat-btn:hover {
                color: #000;
            }

            .cat-btn.active {
                font-weight: 700;
            }

                .cat-btn.active::after {
                    content: "";
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    height: 3px;
                    background: #000;
                }

        .cart-btn {
            text-decoration: none;
            background: #000;
            color: #fff;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

            .cart-btn:hover {
                background: #333;
                color: #fff;
            }

        .cart-count {
            position: relative; /* remove absolute to align in flex */
            top: 0;
            right: 0;
            background: red;
            color: #fff;
            font-size: 11px;
            font-weight: bold;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }




    </style>
}

<div class="info-bar">
    <strong>Region:</strong> @ViewBag.Region |
    <strong>Cinema:</strong> @ViewBag.Cinema |
    <strong>Collect Date:</strong> @ViewBag.CollectDate
</div>

<div class="top-bar">


    
</div>

<div class="search-cart-bar" style="display:flex; justify-content:center; align-items:center; gap:15px; margin-bottom:15px;">
    <a asp-action="UserSelectRegion" style="background-color:#0d6efd;color:#fff;padding:8px 16px;border:none;border-radius:5px;cursor:pointer;">← Back</a>
    
    <input type="text"
           id="searchBox"
           placeholder="Search product..."
           style="padding:8px; width:250px; border-radius:6px; border:1px solid #ccc;" />

    <a asp-controller="Product"
       asp-action="ShoppingCart"
       class="cart-btn">
        🛒 Cart
        <span class="cart-count">@((ViewBag.Cart?.Count) ?? 0)</span>
    </a>
</div>




<div class="category-bar">
    <a asp-action="UserIndex"
       class="cat-btn @(ViewBag.SelectedCategory == null ? "active" : "")">
        All
    </a>

    @foreach (var c in (List<string>)ViewBag.Categories)
    {
        <a asp-action="UserIndex"
           asp-route-category="@c"
           class="cat-btn @(ViewBag.SelectedCategory == c ? "active" : "")">
            @c
        </a>
    }
</div>

<div id="target">
    <partial name="_UserIndex" />
</div>

<script>
    function loadProducts(page = 1) {
        $.get('@Url.Action("UserIndex")', {
            page: page,
            search: $('#searchBox').val(),
            category: '@ViewBag.SelectedCategory'
        }, function (html) {
            $('#target').html(html);
        });
    }

    // Search
    $('#searchBox').on('keyup', function () {
        loadProducts(1);
    });

    // Paging click
    $(document).on('click', '.page-link', function (e) {
        e.preventDefault();
        let page = $(this).data('page');
        loadProducts(page);
    });
</script>

