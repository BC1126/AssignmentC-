@using AssignmentC_.Models
@model HomeViewModel

@section title {
    <div class="main_2 clearfix">
        <section id="center" class="center_home">
            <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000" data-bs-wrap="true">
                
                <div class="carousel-indicators">
                    @* Change Model.Count to Model.NowShowing.Count *@
                    @for (int i = 0; i < Model.NowShowing.Count; i++) 
                    {
                        <button type="button" 
                                data-bs-target="#carouselExampleCaptions" 
                                data-bs-slide-to="@i" 
                                class="@(i == 0 ? "active" : "")" 
                                aria-current="@(i == 0 ? "true" : "false")">
                        </button>
                    }
                </div>

                <div class="carousel-inner">
                    @* Change Model.Count to Model.NowShowing.Count *@
                    @for (int i = 0; i < Model.NowShowing.Count; i++)
                    {
                        var movie = Model.NowShowing[i]; // Access from .NowShowing
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <img src="~/uploads/@movie.BannerUrl" class="d-block w-100" alt="@movie.Title">
                            <div class="carousel-caption d-md-block">
                                <h3 class="col_oran">@movie.Genre</h3>
                                <h1 class="text-white mt-3">@movie.Title</h1>
                                <p class="mt-3 text-light w-75">@movie.Description</p>
                                
                                <ul class="mb-0 mt-4">
                                    <li class="d-inline-block">
                                        <a class="button" asp-controller="Movie" asp-action="Details" asp-route-id="@movie.MovieId">
                                            <i class="fa fa-check-circle me-1 font_14"></i> More Info
                                        </a>
                                    </li>
                                    <li class="d-inline-block ms-2">
                                        @if (DateTime.Now < movie.PremierDate.AddDays(-7))
                                        {
                                            <a class="button_1" style="background-color: #6c757d; border-color: #6c757d; cursor: not-allowed; opacity: 0.7;">
                                                <i class="fa fa-clock-o me-1 font_14"></i> Coming Soon
                                            </a>
                                        }
                                        else
                                        {
                                            <a class="button_1" asp-controller="Booking" asp-action="SelectShowtime" asp-route-movieId="@movie.MovieId">
                                                <i class="fa fa-check-circle me-1 font_14"></i> Get Ticket
                                            </a>
                                        }
                                    </li>
                                </ul>
                            </div>
                        </div>
                    }
                </div>

                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </section>
    </div>
}

<section id="now_showing" class="p_4 bg-white">
    <div class="container-xl">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="fw-bold mb-0">Now <span class="col_oran">Showing</span></h2>
                <p class="text-muted">Book your tickets for the latest blockbusters</p>
            </div>
        </div>

        <div class="row">
            @* Display up to 4 movies in a single row *@
            @foreach (var movie in Model.NowShowing.Take(4))
            {
                <div class="col-md-3 col-sm-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div style="height: 380px; overflow: hidden;">
                            <a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.MovieId">
                                <img src="~/uploads/@movie.PosterUrl" class="card-img-top h-100 w-100" style="object-fit: cover;" alt="@movie.Title">
                            </a>
                        </div>
                        <div class="card-body text-center p-3">
                            <h5 class="fw-bold text-truncate"><a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.MovieId" class="text-dark text-decoration-none">@movie.Title</a></h5>
                            <p class="small text-muted mb-2">@movie.Genre</p>
                            <a asp-controller="Booking" asp-action="SelectShowtime" asp-route-movieId="@movie.MovieId" class="btn btn-primary w-100 mt-2 rounded-0" style="background-color: #ff4444; border:none;">
                                Get Ticket
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="row mt-3">
            <div class="col-12 text-center">
                <a asp-controller="Movie" asp-action="Index" class="btn btn-outline-dark px-5 py-2 rounded-pill">
                    View All Movies <i class="fa fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </div>
</section>
<br />
<br />
<section id="coming_soon" class="p_3 bg-light">
    <div class="container-xl">
        <div class="row mb-4">
            <div class="col-md-12 text-center">
                <h2 class="mb-0 fw-bold">Coming <span class="col_oran">Soon</span></h2>
                <p class="mt-2 text-muted">Don't miss these upcoming blockbusters</p>
            </div>
        </div>
        
        <div class="row">
            @if (Model.ComingSoon.Any())
            {
                @foreach (var movie in Model.ComingSoon)
                {
                    <div class="col-md-3 col-sm-6 mb-4">
                        <div class="card h-100 border-0 shadow-sm" style="transition: transform 0.2s;">
                            <div style="height: 350px; overflow: hidden; position: relative;">
                                <img src="~/uploads/@movie.PosterUrl" class="card-img-top h-100 w-100" 
                                     style="object-fit: cover;" alt="@movie.Title">
                            </div>
                            
                            <div class="card-body text-center">
                                <h5 class="fw-bold text-truncate">@movie.Title</h5>
                                <p class="small text-muted mb-2">@movie.Genre</p>
                                
                                <div class="badge bg-warning text-dark mb-3">
                                    Premieres: @movie.PremierDate.ToString("dd MMM yyyy")
                                </div>
                                
                                <br/>
                                <a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.MovieId" 
                                   class="btn btn-outline-dark btn-sm rounded-0">
                                    View Details
                                </a>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <p>No upcoming movies scheduled at the moment.</p>
                </div>
            }
        </div>
    </div>
</section>