@removeTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewBag.Title = "Movie Ticket Sales Comparison";
}

<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />

<div class="container mt-4">

    <div class="back-btn">
        <button onclick="window.location.href='/Admin/AdminDashboard'"
                style="background:#0d6efd;
               color:#fff;
               border:none;
               padding:6px 12px;
               border-radius:4px;">
            ← Back
        </button>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">🎬 Movie Ticket Sales Chart</h2>
    </div>

    <form method="get" class="mb-3">
        <select name="viewBy" class="form-control mb-2">
            <option value="day" @(ViewBag.ViewBy == "day" ? "selected" : "")>Day</option>
            <option value="month" @(ViewBag.ViewBy == "month" ? "selected" : "")>Month</option>
            <option value="year" @(ViewBag.ViewBy == "year" ? "selected" : "")>Year</option>
        </select>

        <input type="text" id="date1" name="date1" value="@ViewBag.Date1" />
        <input type="text" id="date2" name="date2" value="@ViewBag.Date2" />

        <button class="btn btn-primary">Compare</button>
    </form>

    <canvas id="chart" height="350"></canvas>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    $("#date1,#date2").datepicker({ dateFormat: 'yy-mm-dd' });

    var data = @Html.Raw(ViewBag.ChartData ?? "[]");

    new Chart(document.getElementById('chart'), {
        type: 'bar',
        data: {
            labels: data.map(x => x.Label),
            datasets: [{
                label: 'Movie Ticket Sales (RM)',
                data: data.map(x => x.TotalSales),
                backgroundColor: ['#36a2eb', '#ff6384']
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: v => 'RM ' + v.toLocaleString()
                    }
                }
            }
        }
    });
</script>
